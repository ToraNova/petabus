{% extends 'support/petabus.html' %}

{% block head %}
{% endblock %}

{% block content %}

    <div id="container">
      <div id="sidebar">
        <div class="sidebar-wrapper">
          <div class="panel panel-default" id="features">
            <div class="panel-heading">
              <h3 class="panel-title">Active Route List
              <button type="button" class="btn btn-xs btn-default pull-right"
              id="sidebar-hide-btn"><i class="fa fa-refresh"></i></button></h3>
            </div>
            <div class="panel-body">
              <div class="row">
                <div class="col-xs-8 col-md-8">
                  <input type="text" class="form-control search" placeholder="Filter" />
                </div>
                <div class="col-xs-4 col-md-4">
                  <button type="button" class="btn btn-primary pull-right sort" data-sort="feature-name" id="sort-btn"><i class="fa fa-sort"></i>&nbsp;&nbsp;Sort</button>
                </div>
              </div>
            </div>

            <div class="sidebar-table">
              <table class="table table-hover" id="feature-list">
                <thead class="hidden">
                  <tr>
                    <th>Route Num</th>
                  <tr>
                  <tr>
                    <th>Name</th>
                  <tr>
                  <tr>
                    <th>TrackButton</th>
                  <tr>
                </thead>
                <tbody class="list"></tbody>
              </table>
            </div>

          </div>
        </div>
      </div>

      <div id="map"></div>

    </div>

{% endblock %}

{% block script %}

    <script type="text/javascript" charset="utf-8">

      var mmap = L.map('map').setView([2.927547, 101.642096], 15);
      L.tileLayer( 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        minZoom: 12,
        maxZoom: 17,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        subdomains: ['a','b','c']
      }).addTo( mmap );

      var namespace = '/active_bus'
      var socket = io.connect('http://' + document.domain + ':' + location.port + namespace); //persistent
      socket.on('connect', function() {
          console.log("active_bus socket connected...")
      });

      function syncSidebar(route_data) {
      /* Empty sidebar features */
      $("#feature-list tbody").empty();
      /* Loop through theaters layer and add only features which are in the map bounds */
      theaters.eachLayer(function (layer) {
        if (map.hasLayer(theaterLayer)) {
          if (map.getBounds().contains(layer.getLatLng())) {
            $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/theater.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
          }
        }
      });
      /* Loop through museums layer and add only features which are in the map bounds */
      museums.eachLayer(function (layer) {
        if (map.hasLayer(museumLayer)) {
          if (map.getBounds().contains(layer.getLatLng())) {
            $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
          }
        }
      });
      /* Update list.js featureList */
      featureList = new List("features", {
        valueNames: ["feature-name"]
      });
      featureList.sort("feature-name", {
        order: "asc"
      });
      }

    </script>

    {% endblock %}
</html>
